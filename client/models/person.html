<!DOCTYPE html><html><head><title>person.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../index.html" class="source"><span class="file_name">README</span></a><a href="../../client/app/page_handler.html" class="source "><span class="base_path">client / app / </span><span class="file_name">page_handler.coffee</span></a><a href="../../client/app/setup.1.html" class="source "><span class="base_path">client / app / </span><span class="file_name">setup.1.coffee</span></a><a href="../../client/app/start_app.-1.html" class="source "><span class="base_path">client / app / </span><span class="file_name">start_app.-1.coffee</span></a><a href="../../client/models/person.html" class="source selected"><span class="base_path">client / models / </span><span class="file_name">person.coffee</span></a><a href="../../client/utils/apis.html" class="source "><span class="base_path">client / utils / </span><span class="file_name">apis.coffee</span></a><a href="../../client/utils/dictionary.html" class="source "><span class="base_path">client / utils / </span><span class="file_name">dictionary.coffee</span></a><a href="../../client/utils/houce.2.html" class="source "><span class="base_path">client / utils / </span><span class="file_name">houce.2.coffee</span></a><a href="../../client/utils/jquery_extensions.html" class="source "><span class="base_path">client / utils / </span><span class="file_name">jquery_extensions.coffee</span></a><a href="../../client/utils/ui.html" class="source "><span class="base_path">client / utils / </span><span class="file_name">ui.coffee</span></a><a href="../../common/common_utils.html" class="source "><span class="base_path">common / </span><span class="file_name">common_utils.coffee</span></a><a href="../../server/config.html" class="source "><span class="base_path">server / </span><span class="file_name">config.coffee</span></a><a href="../../server/server.html" class="source "><span class="base_path">server / </span><span class="file_name">server.coffee</span></a><a href="../.././start.html" class="source "><span class="base_path">. / </span><span class="file_name">start.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>person.coffee</h1><div class="filepath">client/models/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nx">Models</span><span class="p">.</span><span class="nx">person</span>
  <span class="nv">C = </span><span class="nx">@</span>
  <span class="nx">Utils</span><span class="p">.</span><span class="nx">model_new_data</span> <span class="nx">C</span>
  
  <span class="nv">constructor: </span><span class="nf">(data)-&gt;</span>
    <span class="nx">merge</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">data</span>
  </pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Instance methods:</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">get_friends: </span><span class="p">(</span><span class="nx">callback</span><span class="o">=</span><span class="p">(</span><span class="o">-&gt;</span><span class="p">))</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@friends</span><span class="o">?</span>
      <span class="nx">callback</span> <span class="nx">@friends</span>
    <span class="k">else</span> <span class="c1"># TODO: deferring</span>
      <span class="nx">Utils</span><span class="p">.</span><span class="nx">FB</span><span class="p">.</span><span class="nx">get</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">@id</span><span class="si">}</span><span class="s">/friends&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span><span class="o">=&gt;</span>
        <span class="vi">@friends = </span><span class="p">[]</span>
        <span class="k">for</span> <span class="nx">person_data</span> <span class="k">in</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span>
          <span class="nx">@friends</span><span class="p">.</span><span class="nx">push</span> <span class="nx">C</span><span class="p">.</span><span class="nx">new_data</span> <span class="nx">person_data</span>
        <span class="nx">callback</span> <span class="nx">@friends</span>

  <span class="nv">get_likes: </span><span class="p">(</span><span class="nx">callback</span><span class="o">=</span><span class="p">(</span><span class="o">-&gt;</span><span class="p">))</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@likes</span><span class="o">?</span>
      <span class="nx">callback</span> <span class="nx">@likes</span>
    <span class="k">else</span>
      <span class="nx">Utils</span><span class="p">.</span><span class="nx">FB</span><span class="p">.</span><span class="nx">get</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">@id</span><span class="si">}</span><span class="s">/likes&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span><span class="o">=&gt;</span>
        <span class="vi">@likes = </span><span class="p">[]</span>
        <span class="k">for</span> <span class="nx">item_data</span> <span class="k">in</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>create item:</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">@likes</span><span class="p">.</span><span class="nx">push</span> <span class="nv">item = </span><span class="nx">Models</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">new_data</span> <span class="nx">item_data</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>add current person as 'a fan' of the liked item</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">item</span><span class="p">.</span><span class="nx">fans</span> <span class="o">?=</span> <span class="p">{}</span>
          <span class="nx">item</span><span class="p">.</span><span class="nx">fans</span><span class="p">[</span><span class="nx">@id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@</span>
        <span class="nx">callback</span> <span class="nx">@likes</span>
    <span class="k">return</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Class methods:</p>
</td><td class="code"><div class="highlight"><pre>  
  <span class="nv">C.get = </span><span class="p">(</span><span class="nx">fb_id</span><span class="o">=</span><span class="s">&#39;me&#39;</span><span class="p">,</span> <span class="nx">callback</span><span class="o">=</span><span class="p">(</span><span class="o">-&gt;</span><span class="p">))</span><span class="o">-&gt;</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>'me' is a special value in Facebook Open Graph,
store it normally to Data.people[id], but also link Data.state.me to that object.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">person = </span><span class="k">if</span> <span class="nx">fb_id</span> <span class="o">is</span> <span class="s">&#39;me&#39;</span> <span class="k">then</span> <span class="nx">Data</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">me</span> <span class="k">else</span> <span class="nx">Data</span><span class="p">.</span><span class="nx">people</span><span class="p">[</span><span class="nx">whose</span><span class="p">]</span>
    <span class="k">if</span> <span class="nx">person</span><span class="o">?</span>
      <span class="nx">callback</span> <span class="nx">person</span>
    <span class="k">else</span>
      <span class="nx">Utils</span><span class="p">.</span><span class="nx">FB</span><span class="p">.</span><span class="nx">get</span> <span class="nx">fb_id</span><span class="p">,</span> <span class="nf">(data)-&gt;</span>
        <span class="nv">person = </span><span class="nx">C</span><span class="p">.</span><span class="nx">new_data</span> <span class="nx">data</span>
        <span class="nv">Data.state.me = </span><span class="nx">person</span> <span class="k">if</span> <span class="nx">fb_id</span> <span class="o">is</span> <span class="s">&#39;me&#39;</span>
        <span class="nx">callback</span> <span class="nx">person</span>
    <span class="k">return</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Wed Feb 29 2012 17:15:51 GMT+0200 (EET)  </div></div></body></html>