<!DOCTYPE html><html><head><title>common_utils.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../index.html" class="source"><span class="file_name">README</span></a><a href="../client/app_init.-1.html" class="source "><span class="base_path">client / </span><span class="file_name">app_init.-1.coffee</span></a><a href="../client/houce/apis.html" class="source "><span class="base_path">client / houce / </span><span class="file_name">apis.coffee</span></a><a href="../client/houce/data_and_models.2.html" class="source "><span class="base_path">client / houce / </span><span class="file_name">data_and_models.2.coffee</span></a><a href="../client/houce/init_houce.1.html" class="source "><span class="base_path">client / houce / </span><span class="file_name">init_houce.1.coffee</span></a><a href="../client/houce/misc.html" class="source "><span class="base_path">client / houce / </span><span class="file_name">misc.coffee</span></a><a href="../client/houce/pager.html" class="source "><span class="base_path">client / houce / </span><span class="file_name">pager.coffee</span></a><a href="../client/houce/templates.html" class="source "><span class="base_path">client / houce / </span><span class="file_name">templates.coffee</span></a><a href="../client/models/person.html" class="source "><span class="base_path">client / models / </span><span class="file_name">person.coffee</span></a><a href="../client/styles/ccss_helpers.s.html" class="source "><span class="base_path">client / styles / </span><span class="file_name">ccss_helpers.s.coffee</span></a><a href="../client/utils/dictionary.html" class="source "><span class="base_path">client / utils / </span><span class="file_name">dictionary.coffee</span></a><a href="../client/utils/utils.html" class="source "><span class="base_path">client / utils / </span><span class="file_name">utils.coffee</span></a><a href="../common/common_utils.html" class="source selected"><span class="base_path">common / </span><span class="file_name">common_utils.coffee</span></a><a href="../server/config.html" class="source "><span class="base_path">server / </span><span class="file_name">config.coffee</span></a><a href="../server/houce.html" class="source "><span class="base_path">server / </span><span class="file_name">houce.coffee</span></a><a href="../server/server.html" class="source "><span class="base_path">server / </span><span class="file_name">server.coffee</span></a><a href=".././start.html" class="source "><span class="base_path">. / </span><span class="file_name">start.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>common_utils.coffee</h1><div class="filepath">common/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="k">try</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Sugar.js extensions:
Array::equals = (another<em>arr)-> Object.equals this, another</em>arr
Object.defineProperties Object.prototype, a: value: 3 #, b: 4</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nb">Array</span><span class="p">.</span><span class="nv">prototype.get_num = </span><span class="o">-&gt;</span> <span class="k">for</span> <span class="nx">el</span> <span class="k">in</span> <span class="nx">@</span>
    <span class="k">return</span> <span class="nx">el</span> <span class="k">if</span> <span class="nx">el</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">==</span> <span class="nb">Number</span>
  <span class="nb">Array</span><span class="p">.</span><span class="nv">prototype.get_str = </span><span class="o">-&gt;</span> <span class="k">for</span> <span class="nx">el</span> <span class="k">in</span> <span class="nx">@</span>
    <span class="k">return</span> <span class="nx">el</span> <span class="k">if</span> <span class="nx">el</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">==</span> <span class="nb">String</span>
  <span class="nb">Array</span><span class="p">.</span><span class="nv">prototype.get_arr = </span><span class="o">-&gt;</span> <span class="k">for</span> <span class="nx">el</span> <span class="k">in</span> <span class="nx">@</span>
    <span class="k">return</span> <span class="nx">el</span> <span class="k">if</span> <span class="nx">el</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">==</span> <span class="nb">Array</span>
  <span class="nb">Array</span><span class="p">.</span><span class="nv">prototype.get_func = </span><span class="o">-&gt;</span> <span class="k">for</span> <span class="nx">el</span> <span class="k">in</span> <span class="nx">@</span>
    <span class="k">return</span> <span class="nx">el</span> <span class="k">if</span> <span class="nx">el</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">==</span> <span class="nb">Function</span>
  <span class="nb">Array</span><span class="p">.</span><span class="nv">prototype.get_bool = </span><span class="o">-&gt;</span> <span class="k">for</span> <span class="nx">el</span> <span class="k">in</span> <span class="nx">@</span>
    <span class="k">return</span> <span class="nx">el</span> <span class="k">if</span> <span class="nx">el</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">==</span> <span class="nb">Boolean</span>
  </pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>object.each to work as (val,key) params? Or just use Object.each for also arrays when same order needed.
console.log  Object.each
orig<em>object</em>each = Object.prototype.each</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>Object.defineProperty Object.prototype, 'each',
 value: (func)-> Object.each @, func</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>GLOBALS:</p>
</td><td class="code"><div class="highlight"><pre>  
  <span class="k">if</span> <span class="nx">console</span><span class="o">?</span>
    <span class="nv">global.log = global.l = </span><span class="nf">(args...) -&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">console</span><span class="p">,</span> <span class="nx">args</span>
    <span class="nv">global.dir = </span>           <span class="nf">(args...) -&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">console</span><span class="p">,</span> <span class="nx">args</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>global.log = global.l = console.log.bind console # bind messes up with remote console (which overwrites console.log)</p>
</td><td class="code"><div class="highlight"><pre>  <span class="k">else</span>
    <span class="nv">global.log = global.l = global.dir = </span><span class="o">-&gt;</span> <span class="c1"># IE, etc</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>alias for JQuery</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">global.q = </span><span class="nx">$</span> <span class="k">if</span> <span class="nx">$</span><span class="o">?</span>
  </pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>shorhand for query selector  </p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">global.get_el  = </span><span class="nb">document</span><span class="o">?</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">.</span><span class="nx">bind</span> <span class="nb">document</span>
  <span class="nv">global.get_els = </span><span class="nb">document</span><span class="o">?</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">.</span><span class="nx">bind</span> <span class="nb">document</span>

  <span class="nv">global.ins = </span><span class="nf">(o) -&gt;</span>
    <span class="nv">str = </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">o</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="s"> (</span><span class="si">#{</span><span class="k">typeof</span> <span class="nx">o</span><span class="si">}</span><span class="s">):\n&quot;</span>
    <span class="nx">str</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">key</span><span class="si">}</span><span class="s">: </span><span class="si">#{</span><span class="nx">val</span><span class="si">}</span><span class="s">,\n&quot;</span> <span class="k">for</span> <span class="nx">own</span> <span class="nx">key</span><span class="p">,</span><span class="nx">val</span> <span class="k">of</span> <span class="nx">o</span>

  <span class="nv">global.delay = </span><span class="nf">(ms, func)-&gt;</span>
    <span class="k">if</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">isFunction</span> <span class="nx">ms</span> <span class="k">then</span> <span class="nx">ms</span><span class="p">.</span><span class="nx">delay</span><span class="p">()</span> <span class="o">\</span>
                            <span class="k">else</span> <span class="nx">func</span><span class="p">.</span><span class="nx">delay</span> <span class="nx">ms</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Sugar.js Object shorthands:</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">global.each  = </span><span class="nb">Object</span><span class="p">.</span><span class="nx">each</span> <span class="c1">#(a,b)-&gt; Object.each a, b #.bind Object</span>
  <span class="nv">global.merge = </span><span class="nb">Object</span><span class="p">.</span><span class="nx">merge</span>
  <span class="nv">global.equal = </span><span class="nb">Object</span><span class="p">.</span><span class="nx">equal</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>Missing functions in Sugar.js:</p>
</td><td class="code"><div class="highlight"><pre>  
  <span class="nb">Number</span><span class="p">.</span><span class="nv">prototype.toDate = </span><span class="o">-&gt;</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>
    
  <span class="nb">String</span><span class="p">.</span><span class="nv">prototype.parsesToNumber = </span><span class="o">-&gt;</span> <span class="o">not</span> <span class="nb">Object</span><span class="p">.</span><span class="nb">isNaN</span> <span class="k">this</span><span class="p">.</span><span class="nx">toNumber</span><span class="p">()</span>

  <span class="nb">String</span><span class="p">.</span><span class="nv">prototype.toPrimitive = </span><span class="o">-&gt;</span>
    <span class="nv">str = </span><span class="s">&#39;&#39;</span><span class="o">+</span><span class="nx">@</span>
    <span class="k">return</span> <span class="k">throw</span> <span class="s">&quot;&#39;</span><span class="si">#{</span><span class="nx">str</span><span class="si">}</span><span class="s">&#39;.toPrimitive() has illegal character(s).&quot;</span> <span class="k">if</span> <span class="nx">str</span><span class="p">.</span><span class="nx">matches</span> <span class="p">[</span><span class="s">&#39;=&#39;</span><span class="p">,</span> <span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="s">&#39;{&#39;</span><span class="p">]</span>
    <span class="k">try</span> <span class="nb">eval</span> <span class="nx">str</span>
    <span class="k">catch</span> <span class="nx">e</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">str</span>


  <span class="nb">Object</span><span class="p">.</span><span class="nv">remove_els = </span><span class="nf">(obj, test_func)-&gt;</span> <span class="c1"># using Object.prototype.remove would fuck things up properly; no idea why</span>
    <span class="p">(</span><span class="k">delete</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="k">if</span> <span class="nx">test_func</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">val</span> <span class="k">of</span> <span class="nx">obj</span>
    <span class="nx">obj</span>
  
  <span class="nb">Object</span><span class="p">.</span><span class="nv">filter = </span><span class="nf">(obj, test_func)-&gt;</span>
    <span class="nv">new_obj = </span><span class="p">{}</span>
    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">val</span> <span class="k">of</span> <span class="nx">obj</span>
      <span class="nx">new_obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span> <span class="k">if</span> <span class="nx">test_func</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">val</span>
    <span class="nx">new_obj</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><h3>Call same function many times with different params</h3>
</td><td class="code"><div class="highlight"><pre>  <span class="k">if</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="o">?</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span> <span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s">&#39;repeat&#39;</span><span class="p">,</span> <span class="nv">value: </span><span class="nf">(args...)-&gt;</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>TODO: add possibility for many params (given as array)
hmm, no so useful since can't retain functions 'this'..?</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">@</span> <span class="nx">param</span> <span class="k">for</span> <span class="nx">param</span> <span class="k">in</span> <span class="nx">args</span>
    </pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>Define .forEach also for objects; equal to .each,
except has same order of parameter as in Arrays: (value,key)
Object.forEach:</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nb">Object</span><span class="p">.</span><span class="nv">forEach = </span><span class="nf">(obj, func)-&gt;</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">each</span> <span class="nx">obj</span><span class="p">,</span> <span class="nf">(key,val)-&gt;</span> <span class="nx">func</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span><span class="nx">key</span><span class="p">)</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>Object.prototype.forEach:</p>
</td><td class="code"><div class="highlight"><pre>  <span class="k">if</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="o">?</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s">&#39;forEach&#39;</span><span class="p">,</span>  <span class="nv">value:</span>
      <span class="nf">(func)-&gt;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">each</span> <span class="nx">@</span><span class="p">,</span> <span class="nf">(key,val)-&gt;</span> <span class="nx">func</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span><span class="nx">key</span><span class="p">)</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>child() creates a new object that inherits from the given object</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">global.child = </span><span class="nf">(parent)-&gt;</span> <span class="c1"># , child</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">child = </span><span class="p">{}).</span><span class="nx">__proto__</span><span class="o">?</span>
      <span class="nv">child.__proto__ = </span><span class="nx">parent</span>
      <span class="nx">child</span>
    <span class="k">else</span> <span class="c1"># IE, Opera</span>
      <span class="nv">child_func = </span><span class="o">-&gt;</span>
      <span class="nv">child_func.prototype = </span><span class="nx">parent</span>
      <span class="k">new</span> <span class="nx">child_func</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>Object.defineProperty Object.prototype, 'child',  (value: -> <strong>proto</strong>:@) if Object.defineProperty?</p>
</td><td class="code"><div class="highlight"><pre>  </pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>Object prototype:</p>
</td><td class="code"><div class="highlight"><pre>  <span class="k">if</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="o">?</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s">&#39;first&#39;</span><span class="p">,</span>  <span class="nv">value: </span><span class="o">-&gt;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">@</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s">&#39;remove_els&#39;</span><span class="p">,</span> <span class="nv">value: </span><span class="nf">(test_func)-&gt;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">remove_els</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">test_func</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyNames</span><span class="o">?</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s">&#39;own&#39;</span><span class="p">,</span> <span class="nv">value: </span><span class="o">-&gt;</span>
        <span class="nv">o = </span><span class="p">{}</span>
        <span class="k">for</span> <span class="nx">name</span> <span class="k">in</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyNames</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>
          <span class="nx">o</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span>
        <span class="nx">o</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>Chek if primitive is found in array or in object (as top level value)
e.g.  if some<em>str.is</em>in ['aa', 'bb', 'cc'] then ...
NOTE: works only for primitives, not objects!</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s">&#39;is_in&#39;</span><span class="p">,</span> <span class="nv">value: </span><span class="nf">(arr_or_obj)-&gt;</span>
      <span class="k">for</span> <span class="nx">own</span> <span class="nx">k</span><span class="p">,</span><span class="nx">v</span> <span class="k">of</span> <span class="nx">arr_or_obj</span>
        <span class="k">return</span> <span class="kc">true</span> <span class="k">if</span> <span class="nx">@</span><span class="o">+</span><span class="s">&#39;&#39;</span> <span class="o">is</span> <span class="nx">v</span><span class="o">+</span><span class="s">&#39;&#39;</span> <span class="o">and</span> <span class="k">typeof</span> <span class="nx">v</span> <span class="o">isnt</span> <span class="s">&#39;object&#39;</span>
      <span class="kc">false</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>Same as .is_in, except check also for partial strings
e.g. "baad".matches['aa'] # true</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span> <span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s">&#39;matches&#39;</span><span class="p">,</span> <span class="nv">value: </span><span class="nf">(strings)-&gt;</span>
      <span class="k">return</span> <span class="kc">null</span> <span class="nx">unless</span> <span class="k">typeof</span> <span class="nx">strings</span> <span class="o">is</span> <span class="s">&#39;array&#39;</span> <span class="o">or</span> <span class="k">typeof</span> <span class="nx">strings</span> <span class="o">is</span> <span class="s">&#39;object&#39;</span>
      <span class="k">for</span> <span class="nx">own</span> <span class="nx">k</span><span class="p">,</span><span class="nx">str</span> <span class="k">of</span> <span class="nx">strings</span>
        <span class="k">return</span> <span class="kc">true</span> <span class="k">if</span> <span class="nx">@</span><span class="p">.</span><span class="nx">match</span> <span class="nx">str</span><span class="p">.</span><span class="nx">escapeRegExp</span><span class="p">()</span>
      <span class="kc">false</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>CONFLICTS WITH GOOGLE MAPS:
Object.defineProperty Object.prototype, 'length', value: -> Object.keys(@).length</p>

<h1>result invokes the object if it is a function, other wise just returns it</h1>

<p>Object.defineProperty Object.prototype, 'result', value: ->
  if @.constructor is Function then @() else @
  # NOTICE: 123.result() isnt 123 (dunno how this should be fixed)</p>
</td><td class="code"><div class="highlight"><pre>  
  <span class="nv">global.result_of = </span><span class="nf">(a)-&gt;</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">a</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span> <span class="k">then</span> <span class="nx">a</span><span class="p">()</span> <span class="k">else</span> <span class="nx">a</span>

  </pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>global.desc = (msg)-> console.info(msg) # describes code</p>
</td><td class="code"><div class="highlight"><pre>  </pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>ifs: short version for returning the value (normally string) if argument
exists, otherwise returns empty string:</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">global.ifs = </span><span class="nf">(arg, true_str, false_str)-&gt;</span>
    <span class="nv">true_str = </span><span class="nx">arg</span> <span class="nx">unless</span> <span class="nx">true_str</span><span class="o">?</span>
    <span class="k">if</span> <span class="nx">arg</span> <span class="k">then</span> <span class="nx">true_str</span> <span class="k">else</span> <span class="p">(</span><span class="k">if</span> <span class="nx">false_str</span><span class="o">?</span> <span class="k">then</span> <span class="nx">false_str</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

  <span class="nv">global.is_blank = </span><span class="nf">(obj)-&gt;</span> <span class="o">not</span> <span class="nx">obj</span><span class="o">?</span> <span class="o">or</span> <span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">and</span> <span class="sr">/^\s*$/</span><span class="p">.</span><span class="nx">test</span> <span class="nx">obj</span><span class="p">)</span> <span class="o">\</span>
                                     <span class="o">or</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">obj</span> <span class="o">is</span> <span class="s">&#39;object&#39;</span> <span class="o">and</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">obj</span><span class="p">).</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span><span class="p">)</span>

  <span class="nv">global.callbacks = </span><span class="nf">(args...)-&gt;</span>
    <span class="k">if</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">2</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>args: [async<em>func</em>1, af2, ...], final_cb</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">async_funcs = </span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="nv">final_cb    = </span><span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>args: async<em>func</em>1, af2, ..., final_cb</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nv">final_cb    = </span><span class="nx">args</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>
      <span class="nv">async_funcs = </span><span class="nx">args</span>
    
    <span class="nv">af_responses = </span><span class="p">[]</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>executed after all async_funcs are ready:</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">af_ready = </span><span class="p">(</span><span class="o">-&gt;</span>
      <span class="nx">final_cb</span><span class="p">.</span><span class="nx">apply</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">af_responses</span>
    <span class="p">).</span><span class="nx">after</span> <span class="nx">async_funcs</span><span class="p">.</span><span class="nx">length</span>

    <span class="k">for</span> <span class="nx">af</span><span class="p">,</span> <span class="nx">ind</span> <span class="k">in</span> <span class="nx">async_funcs</span>
      <span class="nx">do</span> <span class="o">-&gt;</span>
        <span class="nv">i = </span><span class="nx">ind</span>
        <span class="nv">af_callback = </span><span class="nf">(res)-&gt;</span>
          <span class="nx">af_responses</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">res</span>
          <span class="nx">af_ready</span><span class="p">()</span>
        <span class="k">if</span> <span class="k">typeof</span> <span class="nx">af</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
          <span class="nx">af</span> <span class="nx">af_callback</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">isArray</span> <span class="nx">af</span></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><p>af is [af, param1, param2, ...]</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nv">params = </span><span class="nx">af</span>
          <span class="nv">af     = </span><span class="nx">params</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
          <span class="nv">params = </span><span class="nx">params</span><span class="p">.</span><span class="nx">concat</span> <span class="nx">af_callback</span>
          <span class="nx">af</span><span class="p">.</span><span class="nx">apply</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">params</span>
        <span class="k">else</span>
          <span class="k">throw</span> <span class="s">&quot;Illegal asyn_func param for callbacks&quot;</span>
    <span class="k">return</span></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><p>returns an array with push and shift methods that destory equal elements</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">global.uniq = </span><span class="nf">(arr)-&gt;</span>
    <span class="nv">arr.__proto__ = </span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span>
    <span class="nv">arr.unshift = </span><span class="nf">(new_el)-&gt;</span>
      <span class="nx">arr</span><span class="p">.</span><span class="nx">remove</span> <span class="nx">new_el</span> <span class="c1"># removes all elements, not very fast</span>
      <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unshift</span><span class="p">.</span><span class="nx">call</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">new_el</span>
    <span class="nv">arr.push = </span><span class="nf">(new_el)-&gt;</span>
      <span class="nx">arr</span><span class="p">.</span><span class="nx">remove</span> <span class="nx">new_el</span> <span class="c1"># removes all elements, not very fast</span>
      <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">push</span><span class="p">.</span><span class="nx">call</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">new_el</span>
    <span class="nx">arr</span>

<span class="k">catch</span> <span class="nx">err</span>
  <span class="k">if</span> <span class="nx">alert</span><span class="o">?</span> <span class="k">then</span> <span class="nx">alert</span> <span class="s">&quot;Error in common_utils: </span><span class="si">#{</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="s">&quot;</span> <span class="o">\</span>
            <span class="k">else</span> <span class="k">throw</span> <span class="nx">err</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Mon Aug 13 2012 14:10:28 GMT+0300 (EEST)  </div></div></body></html>