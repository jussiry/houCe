<!DOCTYPE html><html><head><title>misc.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../index.html" class="source"><span class="file_name">README</span></a><a href="../../client/app_init.-1.html" class="source "><span class="base_path">client / </span><span class="file_name">app_init.-1.coffee</span></a><a href="../../client/houce/apis.html" class="source "><span class="base_path">client / houce / </span><span class="file_name">apis.coffee</span></a><a href="../../client/houce/data_and_models.2.html" class="source "><span class="base_path">client / houce / </span><span class="file_name">data_and_models.2.coffee</span></a><a href="../../client/houce/init_houce.1.html" class="source "><span class="base_path">client / houce / </span><span class="file_name">init_houce.1.coffee</span></a><a href="../../client/houce/misc.html" class="source selected"><span class="base_path">client / houce / </span><span class="file_name">misc.coffee</span></a><a href="../../client/houce/pager.html" class="source "><span class="base_path">client / houce / </span><span class="file_name">pager.coffee</span></a><a href="../../client/houce/templates.html" class="source "><span class="base_path">client / houce / </span><span class="file_name">templates.coffee</span></a><a href="../../client/models/person.html" class="source "><span class="base_path">client / models / </span><span class="file_name">person.coffee</span></a><a href="../../client/styles/ccss_helpers.s.html" class="source "><span class="base_path">client / styles / </span><span class="file_name">ccss_helpers.s.coffee</span></a><a href="../../client/utils/dictionary.html" class="source "><span class="base_path">client / utils / </span><span class="file_name">dictionary.coffee</span></a><a href="../../client/utils/utils.html" class="source "><span class="base_path">client / utils / </span><span class="file_name">utils.coffee</span></a><a href="../../common/common_utils.html" class="source "><span class="base_path">common / </span><span class="file_name">common_utils.coffee</span></a><a href="../../server/config.html" class="source "><span class="base_path">server / </span><span class="file_name">config.coffee</span></a><a href="../../server/houce.html" class="source "><span class="base_path">server / </span><span class="file_name">houce.coffee</span></a><a href="../../server/server.html" class="source "><span class="base_path">server / </span><span class="file_name">server.coffee</span></a><a href="../.././start.html" class="source "><span class="base_path">. / </span><span class="file_name">start.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>misc.coffee</h1><div class="filepath">client/houce/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">$</span><span class="p">.</span><span class="nx">ajaxSetup</span>
  <span class="nv">async: </span><span class="kc">true</span>
  <span class="nv">crossDomain: </span><span class="kc">true</span>
  <span class="nv">dataType: </span><span class="s">&#39;json&#39;</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>dataType: 'jsonp'</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">contentType: </span><span class="s">&quot;application/x-www-form-urlencoded; charset=utf-8&quot;</span>
  <span class="nv">beforeSend: </span><span class="kc">null</span> <span class="c1">#($jqxhr, params)-&gt; $.ajaxStack.push $jqxhr</span>
  <span class="nv">error: </span><span class="nf">(request, statustext, errormsg)-&gt;</span>
    <span class="nx">log</span> <span class="s">&#39;ajax error &#39;</span><span class="p">,</span> <span class="nx">arguments</span>
    <span class="nx">Utils</span><span class="p">.</span><span class="k">try</span> <span class="s">&#39;ajax error&#39;</span><span class="p">,</span> <span class="o">-&gt;</span>
      <span class="nx">unless</span> <span class="nx">errormsg</span><span class="o">?</span><span class="p">.</span><span class="nx">matches</span><span class="o">?</span><span class="p">([</span><span class="s">&#39;abort&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">])</span> <span class="o">or</span> <span class="nx">statustext</span><span class="o">?</span><span class="p">.</span><span class="nx">matches</span><span class="o">?</span> <span class="p">[</span><span class="s">&#39;abort&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">]</span>
        <span class="nx">alert</span> <span class="s">&quot;ajax error: </span><span class="si">#{</span><span class="nx">statustext</span><span class="si">}</span><span class="s"> :: </span><span class="si">#{</span><span class="nx">errormsg</span><span class="si">}</span><span class="s">&quot;</span>


<span class="nb">window</span><span class="p">.</span><span class="nv">reqAnimFrame = </span><span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span> <span class="o">or</span>
                      <span class="nb">window</span><span class="p">.</span><span class="nx">webkitRequestAnimationFrame</span> <span class="o">or</span>
                      <span class="nb">window</span><span class="p">.</span><span class="nx">mozRequestAnimationFrame</span> <span class="o">or</span>
                      <span class="nb">window</span><span class="p">.</span><span class="nx">oRequestAnimationFrame</span> <span class="o">or</span>
                      <span class="nb">window</span><span class="p">.</span><span class="nx">msRequestAnimationFrame</span> <span class="o">or</span>
                      <span class="nf">(callback)-&gt;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>TODO: which is faster: .parents() or .contains() ? http://api.jquery.com/jQuery.contains/</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">$.fn.is_in_dom = </span><span class="o">-&gt;</span> <span class="nx">@parents</span><span class="p">(</span><span class="s">&#39;body&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>

<span class="nv">$.fn.tap = </span><span class="nf">(act)-&gt;</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>alert "ontouchstart " + ('ontouchstart' in document.querySelector 'body')
alert "touchstart " + ('touchstart' in document.querySelector 'body')
if 'ontouchstart' in document.documentElement
     alert 'ontouchstart found!'</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">$</span><span class="p">(</span><span class="nx">@</span><span class="p">).</span><span class="kc">on</span> <span class="s">&#39;touchstart&#39;</span><span class="p">,</span> <span class="nx">act</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>else $(@).click act</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">$.fn.cull = </span><span class="nf">(selector)-&gt;</span>
  <span class="nx">@filter</span><span class="p">(</span><span class="nx">selector</span><span class="p">).</span><span class="nx">add</span> <span class="nx">@find</span><span class="p">(</span><span class="nx">selector</span><span class="p">)</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>faster but don't get all cases:
filtered = @filter selector
if filtered.length then filtered \
                   else @find selector</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>$.fn.animate_orig = $.fn.animate</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">$.fn.anim = </span><span class="nf">(args...)-&gt;</span>
  <span class="nx">merge</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="nv">useTranslate3d: </span> <span class="kc">true</span>
    <span class="nv">leaveTransforms: </span><span class="kc">true</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>alert 'bef anim'</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">animate</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">args</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>alert 'after anim'</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>Retuns title of the current, or given page</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">Houce.page_title = </span><span class="nf">(templ)-&gt;</span>
  <span class="nv">page = </span><span class="nx">Templates</span><span class="p">[</span><span class="nx">templ</span><span class="p">]</span> <span class="k">if</span> <span class="k">typeof</span> <span class="nx">templ</span> <span class="o">is</span> <span class="s">&#39;string&#39;</span>
  <span class="nx">page</span> <span class="o">?=</span> <span class="nx">Pager</span><span class="p">.</span><span class="nx">get_page</span><span class="p">()</span>
  <span class="nv">title = </span><span class="nx">page</span><span class="p">.</span><span class="nx">title</span> <span class="o">or</span> <span class="s">&#39;&#39;</span>
  <span class="nx">result_of</span> <span class="nx">title</span> <span class="c1"># title or title()</span>


<span class="nx">do</span> <span class="o">-&gt;</span>
  <span class="nv">Houce.err_log = global.hel = </span><span class="nf">(msg...)-&gt;</span>
    <span class="nv">msg = </span><span class="nx">msg</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nf">(m)-&gt;</span>
              <span class="k">try</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span> <span class="nx">m</span>
              <span class="k">catch</span> <span class="nx">e</span> <span class="k">then</span> <span class="k">typeof</span> <span class="nx">m</span>
            <span class="p">).</span><span class="nx">join</span> <span class="s">&#39;, &#39;</span>
    <span class="nx">hel</span><span class="p">.</span><span class="nx">msgs</span><span class="p">.</span><span class="nx">push</span> <span class="nx">msg</span>
    <span class="nx">log</span> <span class="s">&quot;HEL: </span><span class="si">#{</span><span class="nx">msg</span><span class="si">}</span><span class="s">&quot;</span>
    <span class="nx">hel</span><span class="p">.</span><span class="nx">msgs</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span> <span class="k">if</span> <span class="nx">hel</span><span class="p">.</span><span class="nx">msgs</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">10</span>
  <span class="nv">hel.msgs = </span><span class="p">[]</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>Send errors to server and show error notice to user</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">Houce.error = </span><span class="nf">(error_str, file_path, line_number)-&gt;</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>skip known bugs</p>
</td><td class="code"><div class="highlight"><pre>  <span class="k">return</span> <span class="k">if</span> <span class="nx">error_str</span><span class="p">.</span><span class="nx">matches</span> <span class="p">[</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>"Script error." # Apparently caused by same origin policy: http://stackoverflow.com/questions/5913978/cryptic-script-error-reported-in-javascript-in-chrome-and-firefox</p>
</td><td class="code"><div class="highlight"><pre>  <span class="p">]</span> <span class="o">or</span> <span class="o">not</span> <span class="nx">Houce</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">logging_on</span>

  <span class="nx">unless</span> <span class="nx">Utils</span><span class="p">.</span><span class="nx">device</span><span class="o">?</span><span class="p">.</span><span class="nx">is_mobile</span><span class="p">()</span> <span class="c1">#alert &quot;error: #{error_str}, file: #{file_path}, line: #{line_number}&quot;</span>
    <span class="nx">log</span> <span class="s">&#39;error_str&#39;</span><span class="p">,</span> <span class="nx">error_str</span>
    <span class="nx">log</span> <span class="s">&#39;file_path&#39;</span><span class="p">,</span> <span class="nx">file_path</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>Show error message to user</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">Templates</span><span class="p">.</span><span class="nx">notice</span><span class="p">.</span><span class="nx">error</span> <span class="p">(</span><span class="nx">dict</span> <span class="s">&#39;error_notice&#39;</span><span class="p">)</span> <span class="o">or</span> <span class="s">&quot;Error!&quot;</span>  <span class="k">if</span> <span class="nx">Templates</span><span class="p">.</span><span class="nx">notice</span><span class="o">?</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>Send to sever</p>
</td><td class="code"><div class="highlight"><pre>  <span class="p">[</span><span class="nx">title</span><span class="p">,</span> <span class="nx">msg</span><span class="p">...]</span> <span class="o">=</span> <span class="nx">error_str</span><span class="p">.</span><span class="nx">split</span> <span class="s">&#39;:&#39;</span>
  <span class="nv">msg = </span><span class="nx">msg</span><span class="p">.</span><span class="nx">join</span> <span class="s">&#39;:&#39;</span>
  <span class="nv">err_stack = </span> <span class="nx">file_path</span><span class="o">?</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">).</span><span class="nx">last</span><span class="p">()</span> <span class="o">or</span> <span class="s">&#39;&#39;</span>
  <span class="nx">err_stack</span> <span class="o">+=</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="nx">line_number</span> <span class="k">if</span> <span class="nx">line_number</span><span class="o">?</span>
  <span class="nx">$</span><span class="p">.</span><span class="nx">post</span> <span class="s">&#39;/err_logs&#39;</span><span class="p">,</span>
    <span class="nv">ua: </span>       <span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span>
    <span class="nv">err_title: </span><span class="nx">title</span>
    <span class="nv">err_msg: </span>  <span class="nx">msg</span>
    <span class="nv">err_stack: </span><span class="nx">err_stack</span>
    <span class="nv">err_logs: </span> <span class="nx">Houce</span><span class="p">.</span><span class="nx">err_log</span><span class="p">.</span><span class="nx">msgs</span> <span class="c1"># JSON.stringify</span>
    <span class="nv">non_err_err: </span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span> <span class="nx">arguments</span>
    <span class="nv">timestamp: </span>   <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
    <span class="nv">path_history: </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span> <span class="nx">Pager</span><span class="p">.</span><span class="nx">path_history</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Mon Aug 13 2012 14:10:27 GMT+0300 (EEST)  </div></div></body></html>